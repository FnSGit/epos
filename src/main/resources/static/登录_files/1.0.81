var Geohash=new function(){var round=Math.round;var max=Math.max;var pow=Math.pow;var log=Math.log;var table="0123456789bcdefghjkmnpqrstuvwxyz";var isGeohash=new RegExp("^["+table+"]+$");var Rect=function(){};Rect.prototype={minlat:-90,maxlat:90,minlng:-180,maxlng:180,halfLat:function(){return(this.minlat+this.maxlat)/2},halfLng:function(){return(this.minlng+this.maxlng)/2}};this.encode=function(lat,lng){if(lat instanceof Array&&lng==null){lng=lat[1];lat=lat[0]}lat*=1;lng*=1;if(lat!==lat)throw new Error("Geohash.encode: lat must be a Number");if(lng!==lng)throw new Error("Geohash.encode: lng must be a Number");var lap=lat.toString().length-lat.toFixed().length-2;var lop=lng.toString().length-lat.toFixed().length-2;var prec=pow(10,-max(lap,lop,0))/2;var rect=new Rect;var result=[];var edge=180;var even=true;var chr=0;var bit=4;var next;var last;while(edge>=prec){if(even){next=rect.halfLng();if(lng>next){chr|=1<<bit;rect.minlng=next}else{rect.maxlng=next}}else{next=rect.halfLat();if(lat>next){chr|=1<<bit;rect.minlat=next}else{rect.maxlat=next}}even=!even;if(bit){bit--}else{last=edge;edge=max(rect.maxlng-rect.minlng,rect.maxlat-rect.minlat);if(last===edge)break;result.push(table[chr]);bit=4;chr=0}}return result.join("")};this.decode=function(hash){if(!isGeohash.test(hash))throw new Error("Geohash.decode: hash must be a geohash string");var rect=new Rect;var latE=90;var lngE=180;var shink=function(bit,value,even){var bin=1<<bit;if(!(bit&1)^!(even&1)){if(bin&value){rect.minlat=rect.halfLat()}else{rect.maxlat=rect.halfLat()}}else{if(bin&value){rect.minlng=rect.halfLng()}else{rect.maxlng=rect.halfLng()}}};for(var i=0,c=hash.length;i<c;i++){var value=table.indexOf(hash[i]);var even=i&1;for(var bit=4;bit>=0;bit--)shink(bit,value,even);if(even){latE/=8;lngE/=4}else{latE/=4;lngE/=8}}var pLat=pow(10,max(1,-round(log(latE)/log(10)))-1);var pLng=pow(10,max(1,-round(log(lngE)/log(10)))-1);return[round(rect.halfLat()*pLat)/pLat,round(rect.halfLng()*pLng)/pLng]}};if(typeof module==="object")module.exports=Geohash;
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("geohash.js")):"function"==typeof define&&define.amd?define(["geohash.js"],n):e.ebridge=n(e.Geohash)}(this,function(o){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;var e=window.navigator.userAgent,n=window.location,t=n.protocol,i=n.origin,r=/iPhone|iPad|iPod/i.test(e),a=(/Android/i.test(e),"@ele_geohash");function c(n,t){Object.keys(t).forEach(function(e){n[e]=t[e]})}function s(e){var n=e;return/^\/\//.test(e)?n=t+e:/^\w+:\/\//.test(e)||(n="".concat(i).concat("/"===e[0]?"":"/").concat(e)),n}function u(i){return Object.keys(i).reduce(function(e,n){var t=i[n];return void 0!==t&&e.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(t))),e},[]).join("&")}function d(e){var i={};return e.replace(/([^#&?=]*)=([^#&?]*)/g,function(e,n,t){i[decodeURIComponent(n)]=decodeURIComponent(t)}),i}function l(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",t=new Error(n);return t.name=e||"ERROR",t}function w(e,n){var t=u(n);return t?"".concat(e).concat(/[?#]/.test(e)?"&":"?").concat(t):e}function f(e){return window.my&&window.my[e]}var g={NO_HANDLER:"NO_HANDLER",TIMEOUT:"TIMEOUT",USER_DENIED:"USER_DENIED",UNKNOWN_ERROR:"UNKNOWN_ERROR"},h="h5.ele.me";var m={HY_TIMEOUT:g.TIMEOUT,HY_USER_DENIED:g.USER_DENIED};function p(){var t,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(t={fileName:"takeout-location.txt",share:"true"},new Promise(function(e,n){window.lib.windvane.call("WVFile","read",t,e,n)})).then(function(e){var n,t=JSON.parse(e.data),i=1e3*(o.cacheTimeout||1800);return!t||!t.expirationTime||(n=t.expirationTime,i<new Date-new Date(+n))?Promise.reject():{latitude:t.latitude,longitude:t.longitude}})}function v(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t,n){window.WindVane.call("WVLocation","getLocation",{enableHighAcuracy:!0},function(e){var n=e.coords;t({latitude:n.latitude,longitude:n.longitude})},function(e){n(l(m[e.ret]),e.msg)},1e3*(e.timeout||10))})}function y(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){var n,t,i;n=o,i=r[t=e],t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i})}return o}function I(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],i=!0,o=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(i=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw r}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var A=function(e){return window.document.querySelector('meta[name="'.concat(e,'"]'))};function b(){var e=d(window.location.href).spm||"",n="",t=A("spm-id");if(t){var i=t.getAttribute("content");/^\w+\.\w+$/.test(i)&&(n="".concat(i,".0.0"))}else{var o=A("data-spm"),r=o&&o.getAttribute("content"),a=window.document.body.getAttribute("data-spm");r&&a&&(n="".concat(r,".").concat(a,".0.0"))}var c={};return e&&(c["spm-pre"]=e),n&&(c.spm=n),c}function E(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=b();/[#&?]spm=/.test(e)&&delete i.spm;var o=y({},i,n),r=window.sessionStorage.getItem(a);return/[#&?]geohash=/.test(e)||o.geohash||!r||(o.geohash=r),w(t?s(e):e,o)}function P(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(/^taobao:\/\//.test(e))window.location.href=e;else{var t=E(e,n.query||{});window.WindVane.call("WVNative","openWindow",{url:t},function(){},function(){window.location.href=t})}}var T="WV.Event.APP.Active",R=[];function S(e){var n=e&&e.param&&e.param.from;if("background"!==n){var t="webview"===n;R.forEach(function(e){e({strict:t})})}}function N(e){R.length||window.document.addEventListener(T,S,!1),-1===R.indexOf(e)&&R.push(e)}function _(e){var n=R.indexOf(e);-1!==n&&R.splice(n,1),R.length||window.document.removeEventListener(T,S,!1)}var O={weixin:"wxfriend",weixin_timeline:"wxfriend",weibo:r?"sinaweibo":"weibo",dingtalk:"dingtalk",qq:"qq",alipay:"alipay",contacts:"contacts",copy:"copy",guangjie:"guangjie",momo:"momo",present:"present",qrcode:"qrcode",wangxin:"wangxin"};function W(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(t.bizId||{}).taobao;if(!i)throw new Error("缺少淘宝 businessId");var o=(t.targets||[]).reduce(function(e,n){var t=O[n];return t&&-1===e.indexOf(t)?e.concat(t):e},[]);if(!o.length)throw new Error("targets 校验失败");return new Promise(function(e,n){window.WindVane.call("TBSharedModule","showSharedMenu",{title:t.title,url:t.url,text:t.content,image:t.image,businessId:i,targets:o},e,n)})}var D={getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.useTaoCache?p(e).catch(function(){return v(e)}):v(e)},getDeviceId:function(){return new Promise(function(n,t){window.WindVane.call("TBDeviceInfo","getInfo",{},function(e){n(e.deviceID)},function(e){t(e)})})},openWindow:P,goLogin:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return n.redirect?window.lib.login.goLogin(n.redirect):window.lib.login.goLoginAsync().then(function(){n.success&&n.success()}).catch(function(e){n.fail&&n.fail(e)})},isAppInstall:function(n){return new Promise(function(e){window.WindVane.call("Base","isInstall",n,function(){e(!0)},function(){e(!1)})})},openShop:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!e.tbId)throw new Error("tbId is not found");var n=y({},e.extra||{},{shopId:e.tbId,anchorItemId:e.tbItemId,spm:e.spm});P("//h5.m.taobao.com/app/waimai/shop.html?".concat(u(n)))},showToast:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.WindVane.call("WVUIToast","toast",{message:e.message,duration:e.duration||2})},onPageResume:N,offPageResume:_,share:W,popWindow:function(){window.WindVane.call("WVNative","nativeBack")},setShare:function(e,n){document.addEventListener("TBNaviBar.moreItem.clicked",function(){setTimeout(function(){W(e),"function"==typeof n&&n()},100)},!1);window.WindVane&&window.WindVane.call("WebAppInterface","setNaviBarMoreItem",{items:[{icon:"share",fromNative:"true",iconFont:"true",text:"分享"}],autoReset:!0},function(){},function(){})}};var M={weixin:{value:0},weixin_timeline:{value:1},weibo:{value:2},qq:{value:4},qzone:{value:5},dingtalk:{value:8}};function x(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.targets||[];if(!n.length)throw new Error("targets 校验失败");var t="image"===e.contentType?1:0;return 1===n.length?window.location.href="eleme://share?".concat(u({type:M[n[0]].value,title:e.title,text:e.content,url:e.url,image_url:encodeURI(decodeURI(e.image)),image_only:t})):window.hybridAPI.sharePanel({targets:n.filter(function(e){return!!M[e]}),title:e.title,text:e.content,url:e.url,image_url:e.image,source:(e.bizId||{}).eleme||"",image_only:t}),Promise.resolve()}var L={getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(r,a){window.hybridAPI.compareVersion("7.26")?window.hybridAPI.getGlobalGeohash().then(function(e){if(e){var n=I(o.decode(e),2),t=n[0],i=n[1];r({latitude:t,longitude:i})}else a(l(g.USER_DENIED))}):window.hybridAPI.getSyncLocation().then(function(e){var n=e.lat,t=e.lng,i=e.locLat,o=e.locLng;-180!==n?r({latitude:n,longitude:t}):-180!==i?r({latitude:i,longitude:o}):a(l(g.USER_DENIED))}),setTimeout(function(){a(l(g.TIMEOUT))},1e3*(e.timeout||10))})},getDeviceId:function(){return window.hybridAPI.getCuid()},openWindow:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(/^eleme:\/\//.test(e))window.location.href=e;else{var t=y({},n.elemeParams||{},{url:E(e,n.query||{})});t.animation_type=t.animation,delete t.animation,window.location.href="eleme://web?".concat(u(t))}},goLogin:function(){window.location.href="eleme://login"},isAppInstall:function(e){if(r)return 0<window.hybridAPI.compareVersion("8.3.0")?Promise.reject(l(g.NO_HANDLER)):window.hybridAPI.checkAppInstall(e.ios);var n=e.android;return window.hybridAPI.checkPackages([n]).then(function(e){return e[n]})},openShop:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!e.scheme)throw new Error("scheme is not found");window.location.href=e.scheme},showToast:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.hybridAPI.toast({text:e.message,duration:1e3*(e.duration||2)})},onPageResume:N,offPageResume:_,share:x,popWindow:function(){window.hybridAPI.closePage()},setShare:function(e,n){var t=(window.hybridAPI||{}).setRightMenu;t&&t([{text:e.shareText||"分享",iconHash:e.shareIcon||"https://fuss10.elemecdn.com/0/6e/b1b68e054bc6337952d477810fe43png.png",eventName:e.shareEventName||"shareStage",action:function(){x(e),"function"==typeof n&&n()},overflow:!1}])}};function U(){var e=(window.location.href.match(/[?#&]geohash=(\w+)/)||[])[1];if(e||(e=window.sessionStorage.getItem(a)),e&&window.Geohash)try{var n=I(window.Geohash.decode(e),2),t=n[0],i=n[1];return window.sessionStorage.setItem(a,e),{latitude:t,longitude:i}}catch(e){}return null}var B={11:g.USER_DENIED,14:g.TIMEOUT},k={12:g.USER_DENIED};function j(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(/^alipays:\/\//.test(e))window.location.href=e;else if(window.AlipayJSBridge){var t,i=b();/[#&?]spm=/.test(e)&&delete i.spm,/[#&?]geohash=/.test(e)||(t=window.sessionStorage.getItem(a)),window.ap.pushWindow({url:s(e),params:n.launchParams||{},data:y({},i,t?{geohash:t}:{},n.query||{})})}else window.location.href=w(e,n.query||{})}function q(e){if(!e.eId)throw new Error("eId is not found");var n=y({},e.extra||{},{id:e.eId,food_id:e.eItemId,spm:e.spm});if(e.scheme){var t=d(e.scheme);if(t.cart_operations)try{var i=JSON.parse(t.cart_operations).add_foods;i&&i.length&&(n.cartOperations=JSON.stringify({add_foods:i.map(function(e){return{id:e.id,sku_id:e.sku_id}})}))}catch(e){}}return"//".concat(h,"/shop/#").concat(u(n))}var V=[];function C(){V.forEach(function(e){e({strict:!0})})}var H={weixin:"Weixin",weixin_timeline:"WeixinTimeLine",weibo:"Weibo",dingtalk:"DingTalkSession",qq:"QQ"};function J(e,i){return new Promise(function(n,t){window.AlipayJSBridge.call("shareToChannel",{name:e,param:{title:i.title,content:i.content,url:i.url,imageUrl:i.image,otherParams:i.otherParams||{},contentType:i.contentType||"url"}},function(e){e.shareResult?n():t()})})}function G(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=(n.targets||[]).reduce(function(e,n){return H[n]?e.concat(H[n]):e},[]);if(!i.length)throw new Error("targets 校验失败");return 1===i.length?J(i[0],n):new Promise(function(e){t?window.AlipayJSBridge.call("setToolbarMenu",{menus:[],override:!0}):window.AlipayJSBridge.call("setToolbarMenu",{reset:!0}),window.AlipayJSBridge.call("startShare",{bizType:(n.bizId||{}).alipay||"template_normal",onlySelectChannel:i},e)}).then(function(e){return J(e.channelName,n)})}var z={getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(e.checkQuery){var n=U();if(n)return Promise.resolve(n)}var t=window.ap.compareVersion("10.0.18")<0,i=e.timeout||10,o=e.cacheTimeout||1800;return(t?window.ap.getLocation({timeout:i,cacheTimeout:o}):window.ap.call("getCurrentLocation",{timeout:i,cacheTimeout:o,requestType:0,bizType:"".concat(r?"iOS":"Android","-ele-position")})).then(function(e){return{latitude:e.latitude,longitude:e.longitude}}).catch(function(e){throw l((t?k:B)[e.error],e.errorMessage||"定位失败")})},getDeviceId:function(){return window.ap.call("getClientInfo").then(function(e){return e["device.id"]})},openWindow:j,goLogin:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).redirect||window.location.href;window.location.href="//".concat(h,"/login/#redirect=").concat(encodeURIComponent(e))},isAppInstall:function(e){var t={scheme:e.ios,packageName:e.android};return new Promise(function(n){window.ap.isInstalledApp?window.ap.isInstalledApp(t,function(e){n(e.isInstalled)}):window.AlipayJSBridge.call("isInstalledApp",t,function(e){n(e.installed)})})},openShop:function(){j(q(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))},showToast:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.ap.showToast({content:e.message,duration:1e3*(e.duration||2)})},onPageResume:function(e){V.length||window.ap.onPageResume(C),-1===V.indexOf(e)&&V.push(e)},offPageResume:function(e){var n=V.indexOf(e);-1!==n&&V.splice(n,1),V.length||window.ap.offPageResume(C)},share:G,popWindow:function(){window.ap.popWindow()},setShare:function(e,n){window.ap.setOptionButton({onClick:function(){G(e,!1),"function"==typeof n&&n()},reset:!1,preventDefault:!0})}},K={1:g.USER_DENIED,3:g.TIMEOUT};function Q(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(e.checkQuery){var n=U();if(n)return Promise.resolve(n)}return/Youku\/([0-9.]+)/.test(window.navigator.userAgent)?Promise.reject(l(g.NO_HANDLER)):new Promise(function(r,a){window.navigator.geolocation.getCurrentPosition(function(e){var n=e.coords;if(!n.latitude)return a(l(g.USER_DENIED));var t=n.latitude,i=n.longitude;if(window.Geohash){var o=window.Geohash.encode(t,i);window.sessionStorage.setItem("ele_geohash",o)}return r({latitude:t,longitude:i})},function(e){a(l(K[e&&e.code],e.message))},{timeout:1e3*(e.timeout||10),maximumAge:1e3*(e.cacheTimeout||1800)})})}function Y(){}var F={getLocation:Q,openWindow:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};window.location.href=E(e,n.query||{})},getDeviceId:function(){return Promise.resolve("")},goLogin:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).redirect||window.location.href;window.location.href="//".concat(h,"/login/#redirect=").concat(encodeURIComponent(e))},isAppInstall:function(){return Promise.reject(l(g.NO_HANDLER))},openShop:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.location.href=q(e)},showToast:function(e){window.alert(e.message)},onPageResume:Y,offPageResume:Y,share:function(){return Promise.reject(l(g.NO_HANDLER))},setShare:function(){return Promise.reject(l(g.NO_HANDLER))},popWindow:function(){window.history.back()}};var $={};function X(e,n){var t="https://gm.mmstat.com/eleme-h5.openWindow.".concat(e,"?t=").concat(Date.now(),"&open_url=").concat(encodeURIComponent(n));window.navigator&&window.navigator.sendBeacon?navigator.sendBeacon(t):(new Image).src=t}function Z(e){X("default",e),window.location.href=e}c($,F),c($,{setShare:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.sns&&window.sns.share({title:e.title,link:e.url,desc:e.content,imgUrl:e.image},function(){},function(){})}});var ee={};c(ee,F),c(ee,{getLocation:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=U();return e?Promise.resolve(e):f("getLocation")?new Promise(function(i,e){window.my.getLocation(y({success:function(e){var n=e.longitude,t=e.latitude;i({longitude:n,latitude:t})},fail:function(){Q(n).then(i,e)}},n))}):Q(n)},goLogin:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};f("postMessage")&&window.my.postMessage(y({action:"trustLogin"},e))},openWindow:function(e){var n=E(e,(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).query||{},!1);if(X("pv",n),/postmessage:\/\//.test(n)){if(!f("postMessage"))return void X("js-error",n);var t=I(n.match(/postmessage:\/\/(\S+)/)[1].split("?"),1)[0],i=d(n)||{};window.my.postMessage({action:t,data:i})}else{if(!f("navigateTo"))return X("js-error",n),void Z(n);try{window.my.navigateTo({url:n})}catch(e){Z(n)}}},popWindow:function(){f("navigateBack")&&window.my.navigateBack()}});var ne={},te=window.navigator.userAgent;ne.isAlipayMini=/AliApp\((AP|KB).+MiniProgram/i.test(te),ne.isAlipayMiniApp=ne.isAlipayMini,ne.isTBMini=/AliApp\(TB.+Windmill/i.test(te),ne.isTBMiniApp=ne.isTBMini,ne.isTMMiniApp=/AliApp\(TM.+Windmill/i.test(te),ne.isAliMiniApp=window.__sfc__||ne.isTMMiniApp||ne.isTBMiniApp||ne.isAlipayMiniApp,ne.isAlipay=/AliApp\((AP|KB)\/([\d.]+)\)/i.test(te)&&!ne.isAlipayMini,ne.isTaobao=/AliApp\(TB\/([\d.]+)\)/i.test(te)&&!ne.isTBMini,ne.isEleme=/Eleme/i.test(te),ne.isWeChat=/MicroMessenger/i.test(te),ne.isNotMain=!["isAlipay","isEleme","isTaobao"].some(function(e){return ne[e]});var ie=ne.isAlipay&&window.ap&&z||ne.isTaobao&&window.WindVane&&D||ne.isEleme&&window.hybridAPI&&L||ne.isWeChat&&$||ne.isAliMiniApp&&ee||F;return c(ne,ie),ne});
